// https://rathena.org/board/topic/108276-hourly-points/
//===== Hurtsky Modification =========================================
//= 1.1	=	=	Add Idle, Vending and Chatting Check
//====================================================================
 
-	script	hourly_point_main	-1,{

    OnInit:
		.npc_name$ = strnpcinfo(3);
		.timer = 60000;									//ms
		.idlelimit = 600;								//seconds
        bindatcmd "check",.npc_name$+"::OnAtcommand";
		end;

    OnAtcommand:
        dispbottom "Accumulated "+#daily_minute_count+" minute(s)";
        end;

    OnUpdate:
		if ((checkvending() >= 1) || (checkchatting() == 1)){
			#ven_chat_count++;
			deltimer .npc_name$+"::OnUpdate";
			switch ( #ven_chat_count ) {
				default:
					break;
				case 1: // display first notice after entering venchat mode
					dispbottom "[Hourly Reward]:The hourly points event haulted because you were vending or chatting";
					break;
				case 20: // display second notice after 20 counts of venchat
					dispbottom "[Hourly Reward]:The hourly points event haulted because you were vending or chatting";
					#ven_chat_count = 0; // reset venchat count
					break;
			}
			goto OnTimerReset;
			end;
		}
		if (checkidle() >= .idlelimit){
			#afk_count++;
			deltimer .npc_name$+"::OnUpdate";
			@idletime = (checkidle()/60);
			switch ( #afk_count ) {
				default:
					break;
				case 1: // display first notice after entering idle mode
					dispbottom "[Hourly Reward]:You already in AFK mode in "+@idletime+" minute(s)";
					break;
				case 10: // 10 cycles of AFK getting rewards
					dispbottom "[AFK Reward]:You gained AFKPOINTS for idle "+@idletime+" minute(s)";
					#AFKPOINTS++;
					dispbottom "[AFK Reward]:You have "+#AFKPOINTS+" now";
					break;
				case 20: // display second notice after 20 counts of afk
					dispbottom "[Hourly Reward]:You already in AFK mode in"+@idletime+" minute(s)";
					#afk_count = 0; // reset afk count
					break;
			}
			goto OnTimerReset;
			end;
		}
		#ven_chat_count = 0; 	// reset vending and chatting room count if pass check
		#afk_count = 0;			// reset afk count if pass check
		#daily_minute_count++;
		deltimer .npc_name$+"::OnUpdate";
		dispbottom "Accumulated "+#daily_minute_count+" minute(s)";
		switch ( #daily_minute_count ) {
			default:
				break;
            case 60: // 1hour
				dispbottom "[Hourly Reward]:You received 1 box of gum for continously playing in 1 hour";
				getitem 13607,1;
				break;
            case 120: // 2hour
				dispbottom "[Hourly Reward]:You received 1 box of gum for continously playing in 1 hour";
				getitem 13607,1;
                break;
            case 180: // 3hour
				dispbottom "[Hourly Reward]:You received 1 box of gum for continously playing in 1 hour";
				getitem 13607,1;
                break;
            case 240: // 4hour
				dispbottom "[Hourly Reward]:You received 1 box of gum for continously playing in 1 hour";
				getitem 13607,1;
				break;
            case 300: // 5hour
				dispbottom "[Hourly Reward]:You received 1 box of Gum";
				dispbottom "[Hourly Reward]:You received 2 pieces of Rojak Gold Coin";
				dispbottom "[Hourly Reward]:You received 2 box of Yggdrasil Berry Box";
				dispbottom "[Hourly Reward]:You received 1 piece of Medal of Hunter";
				dispbottom "[Hourly Reward]:Thank you for playing 5 consecutive hours, enjoy your reward!";
				getitem 13607,1;
				getitem 50008,2;
				getitem 13517,2;
				getitem 50028,1;
				#daily_minute_count = 0; // reset.
				break;
		}

	OnTimerReset:
	OnPCLoginEvent:
		addtimer .timer, .npc_name$+"::OnUpdate";
		end;

	OnPCLogoutEvent:
		deltimer .npc_name$+"::OnUpdate";		// delete timer
		#ven_chat_count = 0; 					// reset all
		#afk_count = 0;							// reset all
        #daily_minute_count = 0;				// reset all
		end;
}